version: "3"

services:
  moviepilot:
    container_name: moviepilot
    image: jxxghp/moviepilot:${MOVIEPILOT_VERSION:-latest}
    restart: always
    network_mode: bridge
    volumes:
      - ${MOVIEPILOT_CONFIG_PATH:-./config}:/config
      - ${MOVIEPILOT_MEDIA_PATH:-./media}:/media
    environment:
      - MOVIEPILOT_AUTO_UPDATE=false
      - DOWNLOAD_PATH=/media/downloads
      - LIBRARY_PATH=/media/libraries
      - TRANSFER_TYPE=link
      # Proxy
      - PROXY_HOST=${MOVIEPILOT_PROXY}
      # Coockie Cloud
      - COOKIECLOUD_HOST=${COOKIECLOUD_URL:-https://movie-pilot.org/cookiecloud}
      - COOKIECLOUD_KEY=${COOKIECLOUD_KEY}
      - COOKIECLOUD_PASSWORD=${COOKIECLOUD_PASSWORD}
      # 下载器
      - DOWNLOADER=qbittorrent
      # qBittorrent
      - QB_HOST=${QBITTORRENT_URL}
      - QB_USER=${QBITTORRENT_USERNAME:-admin}
      - QB_PASSWORD=${QBITTORRENT_PASSWORD:-password}
      # Transmission
      - TR_HOST=${TRANSMISSION_URL}
      - TR_USER=${TRANSMISSION_USERNAME:-admin}
      - TR_PASSWORD=${TRANSMISSION_PASSWORD:-password}
      # 通知
      - MESSAGER=telegram
      - TELEGRAM_TOKEN=${TELEGRAM_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      - TELEGRAM_USERS=${TELEGRAM_USERS}
      - TELEGRAM_ADMINS=${TELEGRAM_ADMINS}
      # 媒体服务器
      - MEDIASERVER=emby
      - EMBY_HOST=${EMBY_URL}
      - EMBY_API_KEY=${EMBY_API_KEY}
      # 认证
      - AUTH_TYPE=iyuu
      - IYUU_SIGN=${IYUU_SIGN}
    labels:
      traefik.enable: true
      traefik.http.routers.moviepilot.entrypoints: websecure
      traefik.http.routers.moviepilot.rule: Host(`${MOVIEPILOT_HOST:-mp.example.com}`)
      traefik.http.routers.moviepilot.tls.certresolver: default
